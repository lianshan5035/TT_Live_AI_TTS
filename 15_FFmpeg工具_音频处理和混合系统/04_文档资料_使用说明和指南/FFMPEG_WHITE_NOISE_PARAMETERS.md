# FFmpeg ç™½å™ªéŸ³å‚æ•°æ§åˆ¶æ–‡æ¡£
## TikTok åŠæ— äººç›´æ’­éŸ³é¢‘å¤„ç†ä¸“ç”¨é…ç½®

### ğŸ“‹ æ–‡æ¡£æ¦‚è¿°
æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜FFmpegéŸ³é¢‘å¤„ç†ç³»ç»Ÿä¸­ç™½å™ªéŸ³çš„å‚æ•°é…ç½®ï¼Œç‰¹åˆ«é’ˆå¯¹TikTokåŠæ— äººç›´æ’­åœºæ™¯è¿›è¡Œä¼˜åŒ–ï¼Œç¡®ä¿éŸ³é¢‘èƒ½å¤Ÿé€šè¿‡TikTok AIæ£€æµ‹ï¼Œé¿å…è¢«åˆ¤å®šä¸ºå½•æ’­å†…å®¹ã€‚

---

## ğŸ›ï¸ æ ¸å¿ƒå‚æ•°é…ç½®

### 1. ç™½å™ªéŸ³åŸºç¡€å‚æ•°

```python
"white_noise": {
    "file": "white_noise.wav",        # ç™½å™ªéŸ³æ–‡ä»¶å
    "volume": 0.08,                  # éŸ³é‡çº§åˆ« (8%) - TikTokä¼˜åŒ–
    "description": "ç™½å™ªéŸ³"           # æè¿°
}
```

**ğŸ¯ TikTokåœºæ™¯å»ºè®®**: `volume: 0.08` (8%)
- **åŸå› **: TikTok AIå¯¹èƒŒæ™¯å™ªéŸ³æ•æ„Ÿï¼Œ8%éŸ³é‡æ—¢èƒ½æä¾›ç¯å¢ƒæ„Ÿåˆä¸ä¼šå¹²æ‰°è¯­éŸ³è¯†åˆ«
- **èŒƒå›´**: 0.05-0.12 (5%-12%)

### 2. ä¸»éŸ³é¢‘éŸ³é‡å‚æ•°

```python
main_volume = 0.88  # ä¸»éŸ³é¢‘éŸ³é‡ (88%)
```

**ğŸ¯ TikTokåœºæ™¯å»ºè®®**: `main_volume: 0.88` (88%)
- **åŸå› **: ä¿æŒè¯­éŸ³æ¸…æ™°åº¦ï¼Œç¡®ä¿å†…å®¹å¯å¬æ€§
- **èŒƒå›´**: 0.85-0.92 (85%-92%)

### 3. æ··åˆæƒé‡å‚æ•°

```python
# æœ€ç»ˆæ··åˆæƒé‡
weights = "1 0.25"  # ä¸»éŸ³é¢‘æƒé‡1ï¼ŒèƒŒæ™¯éŸ³æ•ˆæƒé‡0.25
```

**ğŸ¯ TikTokåœºæ™¯å»ºè®®**: `weights: "1 0.25"`
- **åŸå› **: å¹³è¡¡è¯­éŸ³æ¸…æ™°åº¦å’Œç¯å¢ƒçœŸå®æ„Ÿ
- **èŒƒå›´**: "1 0.2" åˆ° "1 0.3"

---

## ğŸ”§ FFmpegå¤„ç†å‚æ•°è¯¦è§£

### 1. éŸ³é¢‘æ ¼å¼å‚æ•°

```bash
# è¾“å‡ºæ ¼å¼è®¾ç½® - TikTokä¼˜åŒ–
-c:a aac          # éŸ³é¢‘ç¼–ç å™¨: AAC (TikTokæ¨è)
-b:a 192k         # éŸ³é¢‘æ¯”ç‰¹ç‡: 192kbps (é«˜è´¨é‡)
-ar 44100         # é‡‡æ ·ç‡: 44.1kHz (æ ‡å‡†)
-ac 2             # å£°é“æ•°: ç«‹ä½“å£°
-f mp4            # å®¹å™¨æ ¼å¼: MP4 (å…¼å®¹æ€§å¥½)
```

**ğŸ¯ TikTokåœºæ™¯å»ºè®®**:
- **æ¯”ç‰¹ç‡**: `192k` (æ¯”é»˜è®¤128kæ›´é«˜è´¨é‡)
- **åŸå› **: TikTokå¯¹éŸ³é¢‘è´¨é‡æœ‰è¦æ±‚ï¼Œ192kç¡®ä¿æ¸…æ™°åº¦

### 2. ç™½å™ªéŸ³å¤„ç†å‚æ•°

```bash
# ç™½å™ªéŸ³å¤„ç†å‘½ä»¤
[{i+1}:a]volume=0.08,atrim=duration={main_duration}[bg{i}]
```

**å‚æ•°è§£é‡Š**:
- `volume=0.08`: ç™½å™ªéŸ³éŸ³é‡8%
- `atrim=duration={main_duration}`: åŠ¨æ€æˆªå–ä¸ä¸»éŸ³é¢‘ç›¸åŒé•¿åº¦
- `[bg{i}]`: è¾“å‡ºæ ‡ç­¾

### 3. åŠ¨æ€æ—¶é•¿å¤„ç†

```python
# è·å–ä¸»éŸ³é¢‘æ—¶é•¿
main_duration = self.get_audio_duration(input_file)

# ç™½å™ªéŸ³æˆªå–å‚æ•°
if sound_name == "white_noise":
    background_filters.append(f'[{i+1}:a]volume=0.08,atrim=duration={main_duration}[bg{i}]')
```

**ğŸ¯ TikTokåœºæ™¯ä¼˜åŠ¿**:
- **å”¯ä¸€æ€§**: æ¯ä¸ªéŸ³é¢‘ä½¿ç”¨ä¸åŒæ—¶é•¿çš„ç™½å™ªéŸ³ç‰‡æ®µ
- **è‡ªç„¶æ€§**: é¿å…é‡å¤æ¨¡å¼è¢«AIæ£€æµ‹

---

## ğŸµ éŸ³æ•ˆç»„åˆå»ºè®®

### 1. TikTokä¼˜åŒ–ç»„åˆ

```python
# æ¨èçš„éŸ³æ•ˆç»„åˆ - TikTokåœºæ™¯
tiktok_optimized_combinations = [
    ["white_noise", "room_tone"],           # åŸºç¡€ç»„åˆ
    ["white_noise", "keyboard"],            # åŠå…¬ç¯å¢ƒ
    ["white_noise", "fireplace"],           # æ¸©é¦¨ç¯å¢ƒ
    ["white_noise", "rain"],                # è‡ªç„¶ç¯å¢ƒ
    ["white_noise", "footsteps"]            # ç”Ÿæ´»ç¯å¢ƒ
]
```

**ğŸ¯ é€‰æ‹©å»ºè®®**:
- **åŠå…¬åœºæ™¯**: `["white_noise", "keyboard"]`
- **ç”Ÿæ´»åœºæ™¯**: `["white_noise", "footsteps"]`
- **è‡ªç„¶åœºæ™¯**: `["white_noise", "rain"]`

### 2. éŸ³é‡å¹³è¡¡é…ç½®

```python
# å„éŸ³æ•ˆéŸ³é‡é…ç½® - TikTokä¼˜åŒ–
background_volumes = {
    "white_noise": 0.08,    # 8% - åŸºç¡€ç¯å¢ƒéŸ³
    "room_tone": 0.06,      # 6% - æˆ¿é—´éŸ³æ•ˆ
    "keyboard": 0.05,       # 5% - é”®ç›˜å£°
    "fireplace": 0.07,      # 7% - ç¯ç«å£°
    "rain": 0.06,           # 6% - é›¨å£°
    "footsteps": 0.04       # 4% - è„šæ­¥å£°
}
```

---

## ğŸ“Š å‚æ•°è°ƒä¼˜æŒ‡å—

### 1. éŸ³é‡è°ƒä¼˜

| åœºæ™¯ | ç™½å™ªéŸ³éŸ³é‡ | ä¸»éŸ³é¢‘éŸ³é‡ | æ··åˆæƒé‡ | è¯´æ˜ |
|------|------------|------------|----------|------|
| **TikTokç›´æ’­** | 0.08 | 0.88 | 1:0.25 | æ¨èé…ç½® |
| **é«˜è´¨é‡å†…å®¹** | 0.06 | 0.90 | 1:0.2 | æ›´æ¸…æ™° |
| **ç¯å¢ƒæ„Ÿå¼º** | 0.10 | 0.85 | 1:0.3 | æ›´è‡ªç„¶ |
| **æµ‹è¯•æ¨¡å¼** | 0.12 | 0.82 | 1:0.35 | è°ƒè¯•ç”¨ |

### 2. è´¨é‡è°ƒä¼˜

| ç”¨é€” | æ¯”ç‰¹ç‡ | é‡‡æ ·ç‡ | è¯´æ˜ |
|------|--------|--------|------|
| **TikTokä¸Šä¼ ** | 192k | 44100Hz | æ¨è |
| **é«˜è´¨é‡å­˜å‚¨** | 256k | 48000Hz | å­˜æ¡£ç”¨ |
| **å¿«é€Ÿå¤„ç†** | 128k | 44100Hz | æµ‹è¯•ç”¨ |

---

## ğŸš€ TikTokåœºæ™¯ä¸“ç”¨é…ç½®

### 1. å®Œæ•´FFmpegå‘½ä»¤ç¤ºä¾‹

```bash
ffmpeg -y \
  -i input.mp3 \
  -i background_sounds/white_noise.wav \
  -i background_sounds/room_tone.wav \
  -filter_complex \
    "[0:a]volume=0.88,aresample=44100[main]; \
     [1:a]volume=0.08,atrim=duration=3.03[bg0]; \
     [2:a]volume=0.06,aloop=loop=-1:size=2e+09,atrim=duration=3.03[bg1]; \
     [bg0][bg1]amix=inputs=2:duration=first[bgmix]; \
     [main][bgmix]amix=inputs=2:duration=first:weights=1 0.25[final]" \
  -map "[final]" \
  -c:a aac -b:a 192k -ar 44100 -ac 2 -f mp4 \
  output.m4a
```

### 2. å‚æ•°é…ç½®æ–‡ä»¶

```json
{
  "tiktok_optimized": {
    "white_noise_volume": 0.08,
    "main_audio_volume": 0.88,
    "mix_weights": "1 0.25",
    "audio_bitrate": "192k",
    "sample_rate": 44100,
    "channels": 2,
    "container_format": "mp4",
    "codec": "aac"
  },
  "background_combinations": [
    ["white_noise", "room_tone"],
    ["white_noise", "keyboard"],
    ["white_noise", "fireplace"]
  ],
  "background_volumes": {
    "white_noise": 0.08,
    "room_tone": 0.06,
    "keyboard": 0.05,
    "fireplace": 0.07
  }
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. TikTok AIæ£€æµ‹è§„é¿

- **éŸ³é‡æ§åˆ¶**: ç™½å™ªéŸ³éŸ³é‡ä¸è¶…è¿‡12%
- **æ—¶é•¿å”¯ä¸€**: æ¯ä¸ªéŸ³é¢‘ä½¿ç”¨ä¸åŒæ—¶é•¿çš„ç™½å™ªéŸ³ç‰‡æ®µ
- **è‡ªç„¶æ··åˆ**: é¿å…è¿‡äºè§„å¾‹çš„éŸ³æ•ˆæ¨¡å¼

### 2. éŸ³é¢‘è´¨é‡ä¿è¯

- **æ¯”ç‰¹ç‡**: å»ºè®®ä½¿ç”¨192kä»¥ä¸Š
- **é‡‡æ ·ç‡**: ä¿æŒ44.1kHzæ ‡å‡†
- **å£°é“**: ä½¿ç”¨ç«‹ä½“å£°å¢å¼ºç©ºé—´æ„Ÿ

### 3. å¤„ç†æ€§èƒ½ä¼˜åŒ–

- **æ‰¹é‡å¤„ç†**: å»ºè®®æ¯æ¬¡å¤„ç†ä¸è¶…è¿‡100ä¸ªæ–‡ä»¶
- **å†…å­˜ç®¡ç†**: å¤§æ–‡ä»¶å¤„ç†æ—¶æ³¨æ„å†…å­˜ä½¿ç”¨
- **é”™è¯¯å¤„ç†**: è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´

---

## ğŸ”„ å‚æ•°æ›´æ–°æ–¹æ³•

### 1. ä¿®æ”¹é…ç½®æ–‡ä»¶

```python
# åœ¨ ffmpeg_audio_processor.py ä¸­ä¿®æ”¹
self.background_sounds["white_noise"]["volume"] = 0.08
```

### 2. åŠ¨æ€å‚æ•°è°ƒæ•´

```python
# å¤„ç†æ—¶åŠ¨æ€è°ƒæ•´
processor.process_single_audio(
    input_file="input.mp3",
    output_file="output.m4a",
    background_combination=["white_noise", "room_tone"],
    main_volume=0.88  # åŠ¨æ€è°ƒæ•´ä¸»éŸ³é¢‘éŸ³é‡
)
```

---

## ğŸ“ˆ æ•ˆæœéªŒè¯

### 1. éŸ³é¢‘è´¨é‡æ£€æŸ¥

```bash
# ä½¿ç”¨ ffprobe æ£€æŸ¥è¾“å‡ºæ–‡ä»¶
ffprobe -v quiet -show_entries format=duration,bit_rate -of csv=p=0 output.m4a
```

### 2. éŸ³é‡åˆ†æ

```bash
# ä½¿ç”¨ ffmpeg åˆ†æéŸ³é‡
ffmpeg -i output.m4a -af "volumedetect" -f null -
```

---

## ğŸ¯ æ€»ç»“

é’ˆå¯¹TikTokåŠæ— äººç›´æ’­åœºæ™¯ï¼Œæ¨èä½¿ç”¨ä»¥ä¸‹æ ¸å¿ƒå‚æ•°ï¼š

- **ç™½å™ªéŸ³éŸ³é‡**: 0.08 (8%)
- **ä¸»éŸ³é¢‘éŸ³é‡**: 0.88 (88%)
- **æ··åˆæƒé‡**: 1:0.25
- **éŸ³é¢‘æ¯”ç‰¹ç‡**: 192k
- **éŸ³æ•ˆç»„åˆ**: ["white_noise", "room_tone"]

è¿™äº›å‚æ•°ç»è¿‡ä¼˜åŒ–ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé¿å…TikTok AIæ£€æµ‹ï¼ŒåŒæ—¶ä¿æŒéŸ³é¢‘è´¨é‡å’Œè‡ªç„¶æ„Ÿã€‚

# FFmpeg 音频处理 Prompt 模板 - 完整详细版

## 🎯 标准处理 Prompt (完整版)

请使用以下完整配置处理音频文件：

### 📋 项目基础配置
- **项目根目录**: `/Volumes/M2/TT_Live_AI_TTS`
- **工作目录**: 自动切换到项目根目录
- **输入目录**: `20_输出文件_处理完成的音频文件`
- **输出目录**: `20.2_ffpmeg输出文件_M4A格式音频文件`
- **输出格式**: M4A (MPEG-4 Audio)
- **音频编码**: AAC (Advanced Audio Coding)
- **比特率**: 128kbps (128,000 bits per second)
- **白噪音音量**: 75% (0.75倍原始音量)

### 🔧 处理规则详细说明
1. **文件扫描规则**:
   - 递归扫描输入目录中的所有子目录
   - 支持格式: MP3, WAV, M4A, AAC, FLAC, OGG
   - 保持原始文件名和目录结构
   - 自动跳过已处理的文件 (输出文件存在且大小>1000字节)

2. **白噪音处理规则**:
   - 为每个文件添加白噪音背景音
   - 使用随机偏移截取白噪音 (避免重复)
   - 白噪音音量设置为75%
   - 白噪音长度自动匹配主音频长度
   - 使用FFmpeg的amix滤镜进行混合

3. **输出文件规则**:
   - 输出格式统一为M4A
   - 音频编码使用AAC
   - 比特率设置为128kbps
   - 保持原始采样率和声道数
   - 文件扩展名统一改为.m4a
   - 完全保持原始目录结构

4. **质量保证规则**:
   - 验证输出文件存在性和完整性
   - 检查文件大小合理性 (>1000字节)
   - 记录处理成功/失败状态
   - 单个文件错误不影响其他文件处理

### 📁 白噪音文件配置
**优先级顺序**:
1. **主要文件**: `15_FFmpeg工具_音频处理和混合系统/09_背景音效_音效文件存储/white_noise.wav`
2. **备用文件1**: `15_FFmpeg工具_音频处理和混合系统/07_输出文件_处理完成的音频/09_背景音效_音效文件存储/white_noise.wav`
3. **备用文件2**: `30_音频处理管道_EdgeTTS真人直播语音处理系统/12_原始管道_基础音频处理系统/assets/ambience/white_noise.wav`

### 📊 监控与统计要求
**实时监控指标**:
- 处理进度百分比 (0-100%)
- 文件计数 (已处理/总文件数)
- 成功/失败文件数量
- 已用时间/剩余时间估算 (HH:MM:SS格式)
- 总文件大小/平均文件大小统计
- 最新处理的文件名
- 各种音频格式的数量和百分比分布
- 处理速度 (文件/秒)

**最终统计报告**:
- 基本统计: 成功/失败文件数量、总大小、平均大小、平均时长
- 格式统计: 各种格式的文件数量和百分比分布
- 大小分布: 按文件大小范围分类统计
- 时长统计: 最短/最长/平均/中位音频时长
- 偏移统计: 白噪音平均偏移和最大偏移
- 性能统计: 总处理时间、平均处理时间

### ⚙️ 技术实现要求
**FFmpeg命令结构**:
```bash
ffmpeg -y \
  -i [输入音频文件] \
  -i [白噪音文件] \
  -filter_complex "[1]atrim=start=[随机偏移]:duration=[音频时长],volume=0.75[noise];[0][noise]amix=inputs=2:duration=first:dropout_transition=0" \
  -c:a aac \
  -b:a 128k \
  [输出文件]
```

**并行处理配置**:
- 使用4个并行处理线程
- 每个线程独立处理文件
- 实时更新处理进度
- 线程安全的统计更新

**错误处理配置**:
- 文件处理超时: 60秒/文件
- FFprobe超时: 30秒/文件
- 错误不重试，记录后继续
- 详细记录所有错误信息

### 🎨 可视化看板要求
**实时显示内容**:
- 进度条: 50字符长度的可视化进度条
- 时间信息: 已用时间、剩余时间、平均处理时间
- 文件统计: 总大小、平均大小、最新处理文件
- 格式分布: 各种格式的数量和百分比
- 处理速度: 文件/秒的处理速度
- 清屏更新: 每次更新清屏重新显示

**显示格式**:
```
🎵 FFmpeg 音频白噪音混合处理器 - 实时处理看板
================================================================================
📊 处理进度: [██████████████████████████████████████████████████] 85.2%
   📁 文件: 8520/10000
   ✅ 成功: 8450 | ❌ 失败: 70

⏱️ 时间统计:
   🕐 已用时间: 1:23:45
   ⏳ 剩余时间: 0:15:30
   📈 平均处理时间: 0.65秒/文件

📁 文件统计:
   💾 总大小: 2,450.30 MB
   📊 平均大小: 287.50 KB
   🔄 最新处理: english_field_1234_en-US-JaneNeural.m4a

📋 格式分布:
   .mp3: 6500 个 (76.5%)
   .wav: 1950 个 (22.9%)
   .m4a: 50 个 (0.6%)

🚀 处理速度: 1.54 文件/秒
================================================================================
💡 提示: 按 Ctrl+C 可安全停止处理
```

请确认以上完整配置无误后开始处理。

---

## 🔄 快速处理 Prompt (简化版)

处理音频文件，使用标准配置：
- **输入**: `20_输出文件_处理完成的音频文件`
- **输出**: `20.2_ffpmeg输出文件_M4A格式音频文件` (M4A格式)
- **白噪音**: 75%音量，随机偏移
- **跳过已处理**: 自动跳过已处理文件
- **显示看板**: 实时可视化处理看板
- **生成报告**: 详细统计报告

---

## 📊 配置检查 Prompt (验证版)

请检查以下FFmpeg音频处理配置是否正确：

### 输入输出设置
- **输入目录**: `20_输出文件_处理完成的音频文件`
- **输出目录**: `20.2_ffpmeg输出文件_M4A格式音频文件`
- **输出格式**: M4A (AAC编码, 128k比特率)
- **目录结构**: 完全保持原始结构

### 处理参数
- **白噪音音量**: 75% (0.75倍)
- **随机偏移**: 启用 (避免重复)
- **跳过已处理**: 启用 (输出文件存在且>1000字节)
- **并行处理**: 4个线程
- **超时设置**: 60秒/文件

### 监控要求
- **实时看板**: 进度条、时间统计、文件统计
- **格式分布**: 各种格式的数量和百分比
- **处理速度**: 文件/秒的处理速度
- **最终报告**: 详细统计报告

### 白噪音文件
- **主要文件**: `15_FFmpeg工具_音频处理和混合系统/09_背景音效_音效文件存储/white_noise.wav`
- **备用文件**: 2个备用白噪音文件路径
- **文件验证**: 存在性、大小、可读性检查

请确认配置无误。

---

## 🎯 一键复制 Prompt (最简版)

```
请使用以下标准配置处理音频文件：

**项目设置:**
- 项目根目录: `/Volumes/M2/TT_Live_AI_TTS`
- 输入目录: `20_输出文件_处理完成的音频文件`
- 输出目录: `20.2_ffpmeg输出文件_M4A格式音频文件`
- 输出格式: M4A (AAC编码, 128k比特率)
- 白噪音音量: 75%

**处理规则:**
1. 扫描输入目录中的所有音频文件 (支持MP3, WAV, M4A, AAC, FLAC, OGG)
2. 跳过已处理的文件 (输出文件已存在且大小>1000字节)
3. 为每个文件添加白噪音，使用随机偏移截取
4. 保持原始文件夹结构
5. 显示实时可视化处理看板
6. 生成详细的统计报告

**白噪音文件路径:**
- `15_FFmpeg工具_音频处理和混合系统/09_背景音效_音效文件存储/white_noise.wav`
- `15_FFmpeg工具_音频处理和混合系统/07_输出文件_处理完成的音频/09_背景音效_音效文件存储/white_noise.wav`
- `30_音频处理管道_EdgeTTS真人直播语音处理系统/12_原始管道_基础音频处理系统/assets/ambience/white_noise.wav`

**监控要求:**
- 实时显示处理进度、剩余时间、文件统计
- 最终报告包含格式分布、大小分布、时长统计
- 记录成功/失败文件数量

请确认以上配置无误后开始处理。
```

---

**模板版本**: 2.0 完整详细版  
**更新日期**: 2024年10月28日  
**适用场景**: 生产环境音频处理  
**兼容性**: FFmpeg 4.0+ / Python 3.7+